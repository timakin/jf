#!/usr/bin/env ruby

require "kireikirei"
require 'optparse'

ARG_OPTIONS = ["i:", "git-diff", "minify"]

module InputProxy
  def stdin?
    return File.pipe?(STDIN) || File.select([STDIN], [], [], 0) != nil
  end

  module_function :stdin?
end

Target = Struct.new("Target", :is_stdin, :body)
target = InputProxy.stdin? ? Target.new(true, $stdin.readlines.join("\n")) : Target.new(false, ARGV.last)
opts = ARGV.getopts(*ARG_OPTIONS)

Kireikirei.execute(target, opts)
